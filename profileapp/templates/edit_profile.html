{% extends "base_profile.html" %} {% load crispy_forms_tags %} {% load static %} 

{% block content %}
<div class="edit-profile" style="background-color: whitesmoke;border-radius: 0.5%;box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2);">
  <div class="card-header">
      <h2 class= "text-center" style="color: #2d1f2c; padding: 1em 0 0.5em 0;"> Edit Profile</h2>
    <!-- <div class="card-body">
      <h4 class="card-title" style="text-align: center; color: #1561A7;">@{{ user.username }}</h4>
      <h4 class="card-title-desc" style="text-align: center; color: #2d1f2c;font-weight: bolder;">{{ user.profile.name }}</h4>
    </div> -->
  </div>
  <!-- FORM -->
  <br>
  <!-- FORM -->
  <div class="row gx-5 justify-content-center" style="color: #1561A7; font-weight: 500; font-size: 17px;">
    <div class="col-md-8" style="font-weight: bold;">
      <!-- method -->
      <form method="POST" id="postform" enctype="multipart/form-data">
        {% csrf_token %}
          <div class="form" id="the_post">
            <!-- #1 -->
            <!-- <div class="container profile picture">
              <div id= "avatar-box" style="text-align: center;">
                <img class="rounded-circle" src="{{ user.profile.avatar.url }}" style="max-height:350px;width:350px;object-fit: cover;" alt="profile picture"/>
                <div class="p-2" type="file" name="file" id="file">{{ profile_form.avatar|as_crispy_field }} </div>
                <p style="font-size: 13px; color: gray;"> * if you want to change your avatar, click this button first before save all changes  </p>
                <input href= "/profileapp/edit-profile" class="btn btn-outline-secondary" type="submit" id="submitava"></input>
              </div>
              </div>
            </div> -->
          <!-- #1 -->
          <div class="container">
            <div id= "avatar-box" style="text-align: center;">
              <img id="id_avatar", class="rounded-circle" src="{{ user.profile.avatar.url }}" style="max-height:350px;width:350px;object-fit: cover;" alt="profile picture"/>
              <div class="p-2">{{ profile_form.avatar|as_crispy_field }} </div>
            </div>
          </div>
          <!-- #2 -->
          <!-- <div id="postform" > -->
            <div class="container">
              <div class="d-flex justify-content-center">
                <div class="order-1 p-2">{{ user_form|crispy }} </div>
              </div>
            </div>
            <!-- #3 -->
            <div class="container">
              <div class="d-flex justify-content-center">
                <div class="order-1 p-2"> {{ profile_form.name|as_crispy_field }} </divid>
                <div class="order-2 p-2"> {{ profile_form.email|as_crispy_field }} </div>
              </div>
            </div>
            <!-- #4 -->
            </div class="container">
              <div class="d-flex justify-content-center">
                <div class="order-1 p-2"> {{ profile_form.phone|as_crispy_field }} </div>
                <div class="order-2 p-2"> {{ profile_form.city|as_crispy_field }} </div>
              </div>
            </div>
            <!-- #5 -->
            <div class="container" style="font-weight: bold;">
              <div class="d-flex justify-content-center">
                <div class="order-1 p-2"> {{ profile_form.bio|as_crispy_field }} </div>
              </div>
            </div>
            <!-- #6 -->
            <div class="container" style="font-weight: bold;">
              <div class="d-flex justify-content-center">
                <div class="order-1 p-2"> {{ profile_form.status|as_crispy_field }} </div>
                <div class="order-1 p-2"> {{ profile_form.vaccinated_status|as_crispy_field }} </div>
              </div>
            </div>
          </div>
          <br>
          <!-- #7 -->
          <div class="card-footer fw-bolder">
            <div class="d-flex justify-content-center">
              <div class="order-1 p-2">
                <button class="btn btn-outline-primary" type="submit" id="btnsave" value="POST">Save Changes</button>
              </div>
              <div class="order-2 p-2">
                <a href= "/profileapp/profile-page" class="btn btn-outline-danger" type="reset" id="btncancel">Cancel</a>
              </div>
            </div>
          </div>
      </form>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script type="text/javascript">
    $(document).ready(function() {
      $(document).on("submit", "#postform", function(e){
        // prevent from normal form behaviour
        e.preventDefault();
        // serialize the form data  
        var serializedData = $(this).serialize();
        var response = "";
        $.ajax ({
          type : 'POST',
          url :  "{% url 'update-profile' %}",
          data : serializedData,
          success : function(response){
            $("#id_name").val(response["name"]);
            $("#id_avatar").attr("src", "/media/" + response["avatar"]);
            $("#id_email").val(response["email"]);
            $("#id_phone").val(response["phone"]);
            $("#id_city").val(response["city"]);
            $("#id_bio").val(response["bio"]);
            $("#id_status").val(response["status"]);
            $("#id_vaccinated_status").val(response["vaccinated_status"]);
            console.log("checking the ajax..")
            alert("Your profile has been updated!")
          },
          error : function(response){
            console.log(response)
          }
        });
      });
    });
    </script>
    <!-- <script type="text/javascript">
      jQuery.noConflict();	
      formdata = new FormData();		
      jQuery("#submitavatar").on("change", function() {
        var file = this.files[0];
        if (formdata) {
          formdata.append("avatar", file);
          jQuery.ajax({
            url: "{% url 'update-profile' %}",
            type: "POST",
            data: formdata,
            processData: false,
            contentType: false,
            success:function(){}
          });
        }						
      });	
    </script> -->
  </div>
</div>
{% endblock content %}